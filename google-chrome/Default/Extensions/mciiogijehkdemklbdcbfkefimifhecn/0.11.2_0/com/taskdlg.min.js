'use strict';window.dataLayer=window.dataLayer||[];function aa(){window.dataLayer.push(arguments)}aa("js",new Date);var ba=chrome.runtime.getManifest().version;aa("config","UA-32450437-5",{allow_google_signals:!1,anonymize_ip:!0,custom_map:{dimension1:"extVersion"}});const ha={ss:300,dz:250,fe_us:150,sf:150,sets:100,stats:50},ia={dz:.3,fe_us:.22,sf:.006,sets:.01,stats:.01},ma={sets:5,stats:5},na={sets:{o:0,l:0},stats:{o:0,l:0}};
function pa(){var e=ma.stats;if(e){var g=na.stats;if(g){var l=Date.now();864E5<l-(g.l||0)&&(g.l=l,g.o=0);if(!(g.o++>=e)&&(g=["_trackEvent","stats","error","noHome",void 0,void 0],e)){l=ia[g[1]]||1;var q=ha[g[1]];q&&Math.floor(5E3*Math.random()*e*l)<q&&(g[1]+=`[${q}][1:${5}]`,g[2]+=`[1:${e}:${l}]`,e={event_category:g[1],extVersion:ba},g[3]&&(e.event_label=g[3]),g[4]&&(e.value=g[4]),g[5]&&(e.non_interaction=!0),aa("event",g[2],e))}}}}
window.addEventListener("load",function(){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src="https://www.googletagmanager.com/gtag/js?id=UA-32450437-5";document.body.appendChild(e)});var qa=localStorage;var ra="undefined"!==typeof InstallTrigger,sa=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||"undefined"!==typeof safari&&safari.W).toString(),ta=!!document.documentMode,ua=!ta&&!!window.T,va="FF"==(window.F&&window.F.S||window.opera||0<=navigator.userAgent.indexOf(" OPR/")?"OPERA":ra?"FF":sa?"SAFARI":ta?"IE":ua?"EDGE":"CHROME")?"about:addons":`chrome://extensions/?id=${chrome.runtime.id}#allow-on-file-urls`;var m=chrome.i18n.getMessage,wa=chrome.runtime.sendMessage;function xa(e){chrome.tabs.create({url:"chrome://settings/downloads"});t("change_downloads_folder",e)}function ya(){chrome.tabs.create({url:va})}function I(e){return e?e.trim():""}var za=/^data:([^;]+)((?:;[^=]+=[^;]+)*)(?:;(base64))?,(.+)$/,Aa=/^(?:(?:https?|ftp):\/\/)?(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[/?#]\S*)?$/i;
function Ba(e){e=e||"";var g=0==e.indexOf("data:"),l=e.indexOf("\r");-1==l&&(l=e.indexOf("\n"));-1!=l?e=e.substr(0,g?Math.min(l,1024):l):g&&1024<e.length&&(e=e.substr(0,1024));return g?za.test(e):Aa.test(e)}function Ca(e,g){return e.replace(/[\/\\]+$/g,"").replace(/[\/\\]+/g,"/").trim()+(0==g?"":"/")}function Da(e,g){return e?g?e.replace(/[\/\\]+$/,"")+"/"+g.replace(/[\/\\]+$/,""):e:g}function L(e){return e.replace(/[\/\\]+/g,0==navigator.platform.indexOf("Win")?"\\":"/")}
function Ea(e){let g=0;"/"==e[e.length-1]&&(g=1);let l=e.lastIndexOf("/",e.length-1-g)+1;return[e.substring(0,l),e.substring(l,Math.max(l,e.length-g))]}
function Fa(e,g){let l=e.split("/");var q=0,u=l.length-1;l[0]||++q;l[u]||--u;if(u<q)return e;e=q+1;var w=u-1;for(q=l[q].length+l[u].length;e<=w&&q<g;){u=Math.min(l[e].length,l[w].length);if(3<u&&q+u>g)break;q+=u;l[e].length<l[w].length?++e:--w}e<=w&&l.splice(e,w-e+1,"...");e=l.length-1-!l[l.length-1];w=l[e];--g;w.length>g?(g=Math.floor(g/2),g=w.slice(0,g)+"..."+w.slice(w.length-g)):g=w;l[e]=g;return l.join("/")}var Q=0;Q=0;Q++;Q++;Q++;Q=0;Q++;Q++;Q++;Q++;Q++;Q++;Q=0;Q++;Q++;Q=0;Q++;Q++;Q++;Q++;
Q=0;Q++;Q++;Q++;Q=0;Q++;Q++;Q++;Q++;Q++;Q=0;Q++;Q++;Q=0;Q++;Q++;Q++;Q=0;Q++;Q++;Q++;Q++;Q++;Q++;Q++;Q++;Q++;Q++;Q++;Q++;Q++;Q++;Q++;Q=0;Q++;Q++;Q++;Q=0;Q++;Q=256;Q++;Q++;Q++;Q++;Q++;Q++;Q=512;Q++;Q++;m("chromesysFailedGenericNetworkError");m("chromesysFailedGenericDownloadError");m("stateDownloading");m("stateQueue");m("statePaused");m("stateFinished");m("stateError");m("stateFileMiss");m("errorNone");m("errorFNameConflict");m("errorNoID");function Ga(e,g,l){chrome.runtime.sendMessage({cmd:g},function(q){if(q&&q.list){l=l||{};const A=document.getElementById(e);for(;A.lastElementChild;)A.removeChild(A.lastElementChild);for(var u=0,w=q.list.length;u<w;++u){let K=q.list[u];if(!K)continue;let G;l.process?G=l.process(K):(G=document.createElement("option"),G.setAttribute("value",K));G&&A.appendChild(G)}l.j&&l.j(A)}})}function Ha(e){e.bind("keydown.escape_focus",function(g){27==g.keyCode&&$(this).blur()})};function Ia(){function e(g,l){g="i18n-"+g;for(var q=document.querySelectorAll("["+g+"]"),u=0;u<q.length;++u){var w=m(q[u].attributes[g].value);q[u][l]=w;q[u].removeAttribute(g)}}e("text","innerText");e("title","title");e("href","href");e("placeholder","placeholder");(function(g,l){g="i18n-"+g;for(var q=document.querySelectorAll("["+g+"]"),u=0;u<q.length;++u){var w=m(q[u].attributes[g].value);q[u].setAttribute(l,w);q[u].removeAttribute(g)}})("tooltip","data-tooltip");(function(g,l){g="i18n-"+g;for(var q=
document.querySelectorAll("["+g+"]"),u=0;u<q.length;++u){var w=q[u].attributes[g].value.split(","),A=w[0];w.shift();w=m(A,w);q[u][l]=w;q[u].removeAttribute(g)}})("textparams","innerText");"undefined"!=typeof bg_settings&&Ja()}
function Ja(){var e=bg_settings.get("font_size");document.documentElement.classList.contains("fs-none")||(document.documentElement.style.fontSize&&document.documentElement.classList.remove("fs-"+document.documentElement.style.fontSize),document.documentElement.style.fontSize=e+"px",document.documentElement.classList.add("fs-"+e+"px"))};const Ka=["",[String.fromCharCode(103),String.fromCharCode(108),String.fromCharCode(99)].join(""),"1_"].join("_");function La(){var e=void 0;var g=qa[Ka+"fe_us"];if(void 0!=g)try{e=JSON.parse(atob(g[1]+g.substr(3)))}catch(l){}g=Date.now();return!e||!e._t||isNaN(e._t)||!isFinite(e._t)||6048E5<g-e._t?{_t:g}:e}
function t(e,g){function l(w){return btoa(w.split("").map(A=>{var K=A.charCodeAt(0),G=0;"_"!=A&&(G=60<K?-55:53);return String.fromCharCode(K+G)}).join(""))}var q=q||1;var u=La();e=l(e)+(g?";"+l(g):"");u[e]=(u[e]||0)+q;(function(w,A){A=btoa(JSON.stringify(A));qa[Ka+w]=String.fromCharCode(97+Math.floor(26*Math.random()))+A[0]+String.fromCharCode(97+Math.floor(26*Math.random()))+A.substr(1)})("fe_us",u)};document.oncontextmenu=function(e){var g=e.target.nodeName.toLowerCase(),l=e.target.type&&e.target.type.toLowerCase();if(!e.target.classList.contains("allow-ctx-menu")&&(e.target.disabled||"textarea"!=g&&("input"!=g||"text"!=l&&"number"!=l)))return!1};
let Ma,W=(()=>{function e(b){return(b=(new RegExp("[\\?&]"+b+"=([^&#]*)")).exec(location.href))?b[1]:void 0}function g(b,a,d,c){R=c&&document.activeElement;let f=document.getElementById("error_msg");D||(D=new mdc.snackbar.MDCSnackbar(f),f.addEventListener("MDCSnackbar:closed",function(h){R&&document.activeElement==f&&R.focus();"action"==h.detail.reason&&X.action&&X.action()}));b?(X=d||{},D.labelText=b,D.timeoutMs=a||4E3,X.text?(D.closeOnEscape=!0,f.classList.remove("no-action"),f.querySelector(".mdc-snackbar__action .mdc-button__label").innerText=
X.text):(D.closeOnEscape=!1,f.classList.add("no-action")),D.open(),c&&f.focus()):D.close()}function l(b){b[0]&&(b=b[0]._mdc_obj_)&&(b.valid=!1)}function q(b,a,d){b[0]&&void 0!=a&&(b=b[0]._mdc_obj_)&&(b[d||"value"]=a)}function u(b){function a(){return d.menu&&d.menu.items&&0!=d.menu.items.length?d.menu.items[0].classList.contains("mdc-list-item--disabled")?null:d.getSelectAdapterMethods().getMenuItemValues()[0]:null}const d=b&&b._mdc_obj_;if(!d)throw"MDC select failed to initialize";d.menu.quickOpen=
!0;b.addEventListener("MDCSelect:change",function(c){ja.val(c.detail.value);console.log("folder=>: "+c.detail.value)});Ha($(d.selectAnchor));d.menuElement.addEventListener("MDCMenuSurface:opened",function(){this.focus()});return{J:()=>d,K:function(){let c=b&&b._mdc_obj_;return c?c.value:""},B:function(c){const f=d.getSelectAdapterMethods().getMenuItemValues();for(let h=0;h<f.length;h++)if(f[h]==c){d.selectedIndex!=h&&(d.selectedIndex=h);return}document.getElementById("folder-select-list").prepend(K(c,
!1));d.layoutOptions();d.selectedIndex=0},U:a,R:function(){return d.menu&&d.menu.items&&0!=d.menu.items.length?a()?(d.selectedIndex=0,!0):!1:!1}}}function w(b){A(b)&&N()}function A(b){var a=v.find("form").N(),d=I(a.folder),c=(a.naming||"").trim().replace(/(^(\\|\/|\.)+)|((\\|\/|\.)+$)/g,"").replace(/\s*(\\|\/)+\s*/g,"/").trim();if(0!=((c?c.length-c.replace(/\*/g,"").length:0)&1))return q(B,c),l(B),g(m("errorInvalidNamingMask")),!1;c.indexOf("*")!=c.lastIndexOf("*")&&t("naming_mask");b=1==b;for(var f=
[],h=a.url.split("\r\n"),n=I(a.referer),k=I(a.desc),p=I(a.text),r=I(a.title),x="on"==a.addtop||"checked"==a.addtop||"yes"==a.addtop,y="",C=0,E=h.length;C<E;++C){var O=I(h[C]).replace(/ /g,"%20");if(O){var da=ca(O);if(da)if(Ba(O.replace(/\[[^\[\]]*\]/g,""))){if(!confirm(Y(da))||""!=a.naming&&-1==a.naming.indexOf("*")&&!confirm(m("confirmBatchDownloadNaming")))return!1;J(da,"",0,function(ea){f.push({url:ea,folder:d,naming:c,referer:n,desc:k})});t("batch_desc")}else y+=O+"\n";else Ba(O)?f.push({url:O,
folder:d,naming:c,referer:n,desc:k,text:p,title:r}):y+=O+"\n"}}a=!0;if(f&&0<f.length)try{h=!1;try{h="chrome-extension:"==window.top.location.protocol}catch(ea){}chrome.runtime.sendMessage({cmd:"new_task",add_paused:b,addtop:x,tasks:f,page_title:ka,source:"dialog_"+(h?"chrono":"others")},function(ea){ea||g(chrome.runtime.lastError)})}catch(ea){g(ea+(Ma?"\n"+Ma:""),-1),a=!1}else a=!1;if(y||0==f.length)a=!1,y=I(y),0<y.length&&q(z,y),l(z),g(m("errorInvalidURLs"));return a}function K(b,a){var d=Fa(b,30);
{var c=d!=b?L(b):"";d=L(d);const f=document.createElement("li");f.setAttribute("data-value",b);c&&f.setAttribute("title",c);a?f.className="mdc-list-item mdc-list-item--disabled folder-na":(f.setAttribute("tabindex","0"),f.className="mdc-list-item");b=document.createElement("span");b.className="mdc-list-item__ripple";a=document.createElement("span");a.className="mdc-list-item__text";a.textContent=d;f.appendChild(b);f.appendChild(a);d=f}return d}function G(b){if(b){var a=z.val();a?q(z,a+"\n"+b):q(z,
b);Z(z[0])}}function M(b,a){b||(b={url:"",referer:"",desc:""});a&&a.fontSize&&(document.documentElement.style.fontSize=a.fontSize+"px");if("<clipboard>"==b.url)g(m("statusReadClipboard"),-1),setTimeout(function(){var c=$("<textarea/>");c.appendTo($("body")).focus();document.execCommand("paste");var f=c.val();c.remove();c=f.trim().replace(/ /g,"%20");b.url=c&&Ba(c)?c:"";g();M(b,a)},100);else{var d=z.val();G(b.url);if(!d){q(v.find("[name=referer]"),b.referer);q(v.find("[name=desc]"),b.desc);q(v.find("[name=addtop]"),
!1,"checked");(d=a?a.taskDef:null)&&d.addtop&&q(v.find("[name=addtop]"),!0,"checked");b.text&&v.find("[name=text]").val(b.text);b.title&&v.find("[name=title]").val(b.title);const c=document.getElementById("filedlg-toggler");c.disabled=!0;Ga("naming_history","naming_list");a&&a.folderSelection?Ga("folder-select-list","path_list_recents",{process:f=>{f=Ca(f);return K(f,!0)},j:f=>{U||chrome.runtime.sendMessage({cmd:"browser_home_path_normalized"},function(h){const n=document.getElementById("folder-row");
h?(f.querySelectorAll(".mdc-list-item").forEach(k=>{k.getAttribute("data-value").startsWith(h)&&(k.classList.remove("folder-na","mdc-list-item--disabled"),k.setAttribute("tabindex","0"))}),a&&a.useLastLocation&&P.R()||P.B(h),a.canFileAccess?(V.m(),c.classList.remove("disable-filedlg")):c.classList.add("disable-filedlg"),c.disabled=!1,n.style.display="",V.s(h)):(n.style.display="none",g(m("msgFolderDisabledNonWritable"),-1,{text:m("tipBtnChangeBrowserDownloadsSettings"),action:xa.bind(void 0,"errNoHome")}),
pa(),U=!0)})}}):document.getElementById("folder-row").style.display="none"}v.removeClass("transparent");b&&b.url?B.focus():z.focus()}}function H(){Array.from(v[0].getElementsByClassName("mdc-text-field")).forEach(b=>{b=[b];q(b,"");q(b,!0,"valid")});P.J().selectedIndex=-1}function N(){v.removeClass("filedlg-expanded");v.addClass("transparent");H();Z(z[0]);V.reset();setTimeout(function(){window.parent.postMessage({cmd:"close_dlg",id:oa},"*")},400)}function Y(b){var a=m("confirmBatchDownload")+"\n",
d="",c=3,f=2,h=c+f+1;J(b,"",0,function(E){0<c--&&(d+=E+"\n");return 0<--h});if(h-1<f){var n="";f-=Math.max(h-1,0);var k={a:[]};k.c=b.c;for(var p=0;p<b.a.length;++p){var r=b.a[p].from,x=b.a[p].b,y=b.a[p].step,C=r;if(0<y)for(;C<=x;C+=y);else for(;C>=x;C+=y);C-=y;k.a.push({from:C,b:r,step:-y,g:b.a[p].g,padding:b.a[p].padding,i:b.a[p].i})}J(k,"",0,function(E){n=E+"\n"+n;return 0<--f});0>=h&&(d+="...\n");d+=n}b.stop=!1;return a=a+d+("\n"+m("confirmProceed"))}function J(b,a,d,c){if(b&&!b.stop)if(d<b.c.length&&
(a+=b.c[d]),d>=b.c.length-1)0==c(a)&&(b.stop=!0);else{var f=b.a[d];if(0<f.step)if(f.g)for(var h=f.from;h<=f.b;h+=f.step)J(b,a+String.fromCharCode(h),d+1,c);else if(f.padding)for(h=f.from;h<=f.b;h+=f.step){var n=Math.abs(h).toString();J(b,a+(0>h?"-":"")+(f.i+n).slice(-Math.max(f.padding,n.length)),d+1,c)}else for(h=f.from;h<=f.b;h+=f.step)J(b,a+h,d+1,c);else if(f.g)for(h=f.from;h>=f.b;h+=f.step)J(b,a+String.fromCharCode(h),d+1,c);else if(f.padding)for(h=f.from;h>=f.b;h+=f.step)n=Math.abs(h).toString(),
J(b,a+(0>h?"-":"")+(f.i+n).slice(-Math.max(f.padding,n.length)),d+1,c);else for(h=f.from;h>=f.b;h+=f.step)J(b,a+h,d+1,c)}}function ca(b){function a(c){return"0"==c[0]&&1<c.length||"-"==c[0]&&"0"==c[1]&&2<c.length}if(-1!=b.indexOf("\x00\x00"))return null;var d={c:[],a:[],stop:!1};b=b.replace(/\[((?:-)?\d+|[a-z]):((?:-)?\d+|[a-z])(?::((?:-)?\d+))?\]/gi,function(c,f,h,n){var k=0;if(void 0!=n&&(k=parseInt(n),isNaN(k)||!isFinite(k)))return c;n=f.charCodeAt(0);var p=h.charCodeAt(0);if(65<=n&&90>=n&&65<=
p&&90>=p||97<=n&&122>=n&&97<=p&&122>=p){if(k=k||(0>p-n?-1:1),p==n||0>p-n==0>k)return d.a.push({g:!0,from:n,b:p,step:k}),"\x00\x00"}else{n=parseInt(f,10);p=parseInt(h,10);if(isNaN(n)||isNaN(p))return c;k=k||(0>p-n?-1:1);if(p==n||0>p-n==0>k){c={g:!1,from:n,b:p,step:k};a(f)?(f=f.length-("-"==f[0]),a(h)?c.padding=Math.max(f,h.length-("-"==h[0])):c.padding=f):a(h)&&(c.padding=h.length-("-"==h[0]));if(c.padding)for(c.i=Array(c.padding+1).join("0"),c.A=1,h=0;h<c.padding;++h)c.A*=10;d.a.push(c);return"\x00\x00"}}return c});
return d.a.length?(d.c=b.split("\x00\x00"),d):null}function fa(b,a,d){g(m("errorUnableOpen",L(Fa(b,60)))+" "+m("msgChooseFolderUnderHome"),7E3,{text:m("tipBtnChangeDefaultLocation"),action:xa.bind(void 0,"errNotUnderHome")},a);t("fdlg_err_outside_home",d)}function Z(b){let a=((b.value||"").match(la)||[]).length+1;4<a&&(a=4);b.setAttribute("rows",a);b.parentElement.classList.toggle("multi-rows",1<a)}let U=!1;$.fn.N=function(){var b={};$.each(this.serializeArray(),function(){void 0!==b[this.name]?(b[this.name].push||
(b[this.name]=[b[this.name]]),b[this.name].push(this.value||"")):b[this.name]=this.value||""});return b};var oa=e("id"),ka=decodeURIComponent((e("page_title")||"").replace(/\+/g," "));let S=e("fs");S&&(document.documentElement.style.fontSize=S+"px");let v,z,B,P,ja;document.addEventListener("DOMContentLoaded",function(){Na();v=$(".overlay");z=v.find("[name=url]");B=v.find("[name=naming]");ja=v.find("[name=folder]");P=new u(v.find("#folder-select")[0]);document.getElementById("folder-select-list").addEventListener("click",
b=>{b=b.target.closest(".folder-na");t("fdlg_folder_list");b&&(b=b.getAttribute("data-value"),fa(b,!0,"list"))});Ia();B.attr("placeholder",m("phraseAutomatic"));z.on("input",function(b,a){function d(...h){let n=Date.now(),k=c+a;n<k?f||(f=setTimeout(function(){f=void 0;d(...h)},k-n)):(c=n,b(...h))}let c=0,f;return d}(Z.bind(this,z[0]),200));$(document).bind("keydown.dydlg",function(b){switch(b.keyCode){case 27:b.target==document.body&&(D&&D.V&&D.closeOnEscape?D.close():v.hasClass("filedlg-expanded")?
V.close():N());break;case 70:case 71:case 79:case 83:if(b.ctrlKey||b.metaKey)return!1}});Ha(v.find("input, textarea, button"));v.find(".close-button").click(function(){N()});v.find(".dlg_start_btn").click(w);Oa(document.getElementById("menu-add-paused"),document.getElementById("btnMenuAddPaused"),function(b){0==b.detail.index&&w(!0)});v.find("#btnSystemFileDlg").click(function(){let b=(z[0].value||"").trim();0<(b.match(la)||[]).length||ca(b)?(l(z),g(m("errorSingleURLAllowed"))):Ba(b)?(t("fdlg_use_system"),
chrome.runtime.sendMessage({cmd:"save_as",url:b}),N()):(l(z),g(m("errorInvalidURLs")))});v.find("#tip-batch_desc").click(function(){chrome.runtime.sendMessage({cmd:"open_options",section:"help.batch_desc"})});v.find("#tip-naming_mask").click(function(){chrome.runtime.sendMessage({cmd:"open_options",section:"help.naming_mask"})});document.getElementById("filedlg-toggler").addEventListener("click",function(b){b.target.classList.contains("disable-filedlg")?g(m("msgFolderDisabledNoFileAccess")+" "+m("msgEnableFileAccess",
["`"+m("chromesysAllowFileAccess")+"`","`"+m("extName")+"`"]),-1,{text:m("btnGrantPermission"),action:ya}):(b=P.K(),v.addClass("ever-expanded"),V.open(b))});V.G(b=>{ja.val(b);console.log("folder=>: "+b)});V.P(b=>{P.B(b)})});let X={},D,R;const la=/\r\n|\r|\n/g;return{m:M,H:G,D:function(b){v.toggleClass("filedlg-expanded",b)},h:g,C:fa,O:q}})();
window.addEventListener("message",function(e){if("init"==e.data.cmd)try{Ma=m("errorUnknownReloadPage"),W.m(e.data.task,e.data.dlg_opts)}catch(g){W.h(g+(Ma?"\n"+Ma:""),-1)}},!1);window.addEventListener("dragover",function(e){var g=e.target.nodeName.toLowerCase();("input"!=g&&"textarea"!=g||e.target.disabled)&&e.preventDefault()},!1);
window.addEventListener("drop",function(e){var g=e.target.nodeName.toLowerCase();if("input"!=g&&"textarea"!=g||e.target.disabled)g=e.dataTransfer.getData("text/plain").replace(/ /g,"%20"),Ba(g)&&(W.H(g),e.preventDefault())},!1);let V=(()=>{function e(a,d){let c=d.f;if("-1"==a.f)return"-1"==c?0:-1;if("-1"==c)return 1;a=S.cmp(a,d);return v?a:-a}async function g(a,d,c){a=Ca(a);if(a!=H){var f=a.startsWith(H)?a.substr(H.length):a;if(f==a)console.error("path to create is not under HOME path");else{a=Ca(Da(H,f.replace(/~|\*|\?|:|\||<|>|"/g,"_")));var h=[a,""];for(f={};h[0]&&h[0].length>=H.length;){var n=[];f[h[0]]=n;h[1]&&n.push(h[1]);if((d||h[0].length<a.length)&&(n=await A(h[0],!0))&&Array.isArray(n.list)){let k;if(h[1]&&(k=
n.list.find(p=>{var r=h[1];return p.url==r||p.name.toLocaleLowerCase()==r.toLocaleLowerCase()}))){W.h(m("errorFileOrFolderExists")+"\n"+L(Da(h[0],k.name)));return}break}if(Array.isArray(z[h[0].toLocaleLowerCase()]))break;h=Ea(h[0])}if(h[0].length==a.length)W.h(m("errorFileOrFolderExists"));else{for(const k in f)(d=z[k.toLocaleLowerCase()])?Array.prototype.push.apply(d,f[k]):z[k.toLocaleLowerCase()]=f[k];G(a);t("new_dir",c)}}}}function l(a){var d=!a.startsWith(H);const c=document.createElement("li");
c.setAttribute("path",a);c.setAttribute("title",L(a));d?c.className="mdc-list-item mdc-list-item--disabled folder-na":(c.setAttribute("tabindex","0"),c.className="mdc-list-item");d=document.createElement("span");d.className="mdc-list-item__ripple";const f=document.createElement("span");f.className="mdc-list-item__text";{var h=0;"/"==a[a.length-1]&&(h=1);h=a.length-h;const n=a.lastIndexOf("/",h-1)+1;a=h<=n?"":a.substring(n,h)}f.textContent=a||"/";c.appendChild(d);c.appendChild(f);return c}function q(){if(D){try{b&&
b(B.current())}catch(a){console.error(a)}W.D(!1);B.reset()}}function u(){let a={process:d=>l(Ca(d)),j:d=>{0==d.getElementsByTagName("li").length&&(d.parentElement.style.display="none")}};Ga("nav-folders-recents-list","path_list_recents",a);Ga("nav-folders-favs-list","path_list_favs",a)}function w(){function a(){if(p)return p;let r=document.getElementById("new-folder-dialog");p=Pa(r);let x=r.querySelector("[name=new-dir-input]"),y=r.querySelector("button:last-child");x.addEventListener("input",()=>
{y.disabled=!(x.value||"").trim()});r.addEventListener("MDCDialog:closed",function(C){"accept"==C.detail.action&&g(Da(B.current(),x.value),!0,"dlg");W.O([x],"")});return p}N=document.getElementById("btn-back");Y=document.getElementById("btn-forward");J=document.getElementById("btn-up");ca=document.getElementById("btn-view");fa=document.getElementById("btn-sort");Z=document.getElementById("btn-new-folder");let d=document.getElementById("main"),c=document.getElementById("nav-folders");const f=["view-details",
"view-icons"];let h=0;d.classList.add(f[h]);ca.addEventListener("click",()=>{d.getElementsByTagName("li").length&&(d.classList.remove(f[h]),h=(h+1)%f.length,d.classList.add(f[h]))});d.addEventListener("click",r=>{let x;r.target&&(x=r.target.closest(".dir-item"))&&(r=x.getElementsByClassName("dir-item-name")[0].innerText,M(Da(B.current(),r)))});const n=document.getElementById("nav-folders-recents-header");n.addEventListener("click",()=>{n.parentElement.classList.toggle("nav-folders-hidden")});const k=
document.getElementById("nav-folders-favs-header");k.addEventListener("click",()=>{k.parentElement.classList.toggle("nav-folders-hidden")});c.addEventListener("click",r=>{let x;r.target&&(x=r.target.closest(".mdc-list-item"))&&(r=x.getAttribute("path"),x.classList.contains("folder-na")?W.C(r,!1,"nav"):M(r),t("fdlg_navlst","nav-folders-favs-list"==x.parentElement.id?"fav":"rec"))});J.addEventListener("click",()=>{const r=B.current();r!=H&&(M(r.replace(/[\/\\][^\/\\:]+[\/\\]?$/,"")),t("fdlg_abar","nav"))});
N.addEventListener("click",()=>{B.back();t("fdlg_abar","nav")});Y.addEventListener("click",()=>{B.forward();t("fdlg_abar","nav")});document.getElementById("btn-close-filedlg").addEventListener("click",q);let p;Z.addEventListener("click",()=>{a().open()});Oa(document.getElementById("menu-downloads-folder"),document.getElementById("button-home-dropdown"),function(r){0==r.detail.index?chrome.downloads.showDefaultFolder():1==r.detail.index&&xa("fdlg")});Oa(document.getElementById("menu-sort"),fa,function(r){0==
r.detail.index?S!==oa?(S=oa,v=!0):v=!v:1==r.detail.index&&(S!==ka?(S=ka,v=!1):v=!v);K()});P=ja(document.getElementById("path-widget"))}function A(a,d){return X("file:///"+a).then(c=>{let f=[];if("timeout"==c||"other_error"==c)return{error:c};if("not_found"!=c)for(var h=/<script>addRow\((.*?)\);<\/script>/g,n;n=h.exec(c);){var k=n[1].split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/);n=k[0].replace(/"/g,"");let p=k[1].replace(/"/g,""),r=k[2],x=k[5];k=k[6].replace(/"/g,"");(d&&"1"!=r||!d&&"1"==r)&&f.push({name:n,
url:p,v:k,f:x})}if(d)return"not_found"==c?null:{list:f};h=z[a.toLocaleLowerCase()];if(!Array.isArray(h))return"not_found"==c?null:{list:f};for(const p of h)f.some(r=>r.name==p)||f.push({name:p,url:encodeURIComponent(p),v:"-",f:"-1"});return{list:f}}).catch(()=>null)}function K(){R=R||[];R.sort(e);var a=document.getElementById("menu-sort");let d=a.querySelector(".sorted-up,.sorted-down");null!=d&&d.classList.remove("sorted-up","sorted-down");a.querySelector(`.sort-row-wrap[data-sortcol=${S.u}]`).classList.add(`sorted-${v?
"up":"down"}`);for(a=document.getElementById("main");a.lastElementChild;)a.removeChild(a.lastElementChild);const c=document.createElement("ul");R.forEach(f=>{const h=document.createElement("li");h.setAttribute("href",f.url);h.className="dir-item";const n=document.createElement("span");n.className="-1"==f.f?"dir-icon material-icons dir-icon-new":"dir-icon material-icons";const k=document.createElement("span");k.className="dir-item-name";k.textContent=f.name;const p=document.createElement("span");p.className=
"dir-item-time";p.textContent=f.v;h.appendChild(n);h.appendChild(k);h.appendChild(p);c.appendChild(h)});a.appendChild(c)}async function G(a,d){a=a||H;if(a==B.I())return 0;var c=a.startsWith(H)?a.substr(H.length):a;if(c==a)return-2;let f=await A(a);if(null==f)return-1;if(f.error||!f.list)return-3;0!=d&&B.push(a);P.set(c);J.disabled=!c;N.disabled=!B.L();Y.disabled=!B.M();fa.disabled=ca.disabled=0==f.list.length;Z.disabled=!1;d=U._mdc_obj_;a:{c=a;var h=document.getElementById("nav-folders-favs-list");
for(h=h.firstElementChild;h;h=h.nextElementSibling)if(h.getAttribute("path")==c){c=!0;break a}c=!1}d.on=c;R=f.list;K();for(const n of la)n(a);return 1}async function M(a,d){a=Ca(a);d=await G(a,d);switch(d){case -1:W.h(m("confirmCreateWhenNotExists","`"+L(Fa(a,60)+"`")),1E4,{text:m("btnCreate"),action:g.bind(V,a,!1,"lsd")});break;case -2:W.C(a);break;case -3:W.h(m("errorUnableOpen",L(Fa(a,60))),4E3)}return d}let H,N,Y,J,ca,fa,Z,U;const oa={u:"name",cmp:(a,d)=>a.name.localeCompare(d.name)},ka={u:"time",
cmp:(a,d)=>a.f.localeCompare(d.f)};let S=ka,v=!1,z={},B=(()=>{function a(){return c<d.length-1}let d=[],c=-1;return{empty:function(){return 0==d.length},push:function(f){for(;d.length-1>c;)d.pop();d.push(f);++c},back:async function(){0<c&&0<=await M(d[c-1],!1)&&(--c,N.disabled=!(0<c),Y.disabled=!a())},forward:async function(){a()&&0<=await M(d[c+1],!1)&&(++c,N.disabled=!(0<c),Y.disabled=!a())},L:function(){return 0<c},M:a,current:function(){if(0<=c&&c<d.length)return d[c];throw"empty path stack";
},I:function(){return 0<=c&&c<d.length?d[c]:""},reset:function(){d=[];c=-1}}})(),P,ja=a=>{function d(k){k?a.classList.add("focused"):a.classList.remove("focused")}let c=a.getElementsByClassName("button-home")[0],f=a.getElementsByClassName("path-home")[0],h=a.getElementsByClassName("buttons-view")[0],n=a.getElementsByClassName("input-view-input")[0];U=a.getElementsByClassName("path-fav")[0];U._mdc_obj_=new mdc.iconButton.MDCIconButtonToggle(U);c.addEventListener("click",()=>{G()});U.addEventListener("MDCIconButtonToggle:change",
function(k){k=k.detail.isOn;const p=B.current();{const r=document.getElementById("nav-folders-favs"),x=document.getElementById("nav-folders-favs-list");let y=0,C=!1;for(let E=x.firstElementChild;E;E=E.nextElementSibling,y++)if(E.getAttribute("path")==p){k?0<y&&(x.removeChild(E),x.prepend(E)):x.removeChild(E);C=!0;break}k&&!C&&x.prepend(l(p));r.style.display=0==x.childElementCount?"none":""}wa({cmd:"fav_path",fav:k,path:p});k&&t("fdlg_abar","fav")});n.addEventListener("blur",()=>{d(!1)});n.addEventListener("keydown",
k=>{13==k.keyCode&&(n.blur(),M(Da(H,n.value)),t("fdlg_abar","enter"))});a.addEventListener("blur",()=>{d(!1)});a.addEventListener("click",k=>{if(k.target.classList.contains("input-view-trigger"))d(!0),n.focus(),n.select();else if(k=k.composedPath().find(p=>p.classList&&p.classList.contains("path-button"))){let p=k.parentElement;if(p.nextElementSibling){for(k=[];p;)k.unshift(p.lastElementChild),p=p.previousElementSibling;M(Da(H,k.map(r=>r.innerText).join("/")));t("fdlg_abar","path_btn")}}});return{set:function(k){let p=
k.split(/[\\\/]/).filter(C=>!!C),r=[].slice.call(h.getElementsByClassName("path-button"));for(;r.length>p.length;)r.pop().parentElement.remove();let x=[];for(;r.length<p.length;){var y=document.createElement("div");let C=document.createElement("span"),E=document.createElement("span"),O=document.createElement("span"),da=document.createElement("span");y.className="path-button-wrap";C.className="path-button-sep";E.className="path-button mdc-button";O.className="mdc-button__ripple";da.className="mdc-button__label";
y.appendChild(C);y.appendChild(E);E.append(O);E.append(da);r.push(E);x.push(y)}for(y=0;y<p.length;++y)r[y].lastElementChild.innerText=p[y];for(;0<x.length;)h.appendChild(x.shift());n.value=L(Ca(k,!1));a.classList.toggle("has-subdirs",0<r.length)},X:d,s:function(k){f.innerText=L(k)}}},X=a=>new Promise(d=>{let c=new XMLHttpRequest;c.timeout=500;c.open("GET",a);c.onloadend=f=>{f.loaded&&c.response?d(c.response):d("not_found")};c.ontimeout=()=>d("timeout");c.send()}),D=!1,R=[],la=[],b;document.addEventListener("DOMContentLoaded",
function(){w()});return{reset:function(){D&&(B.reset(),z={},D=!1)},m:function(){D=!0},open:function(a){if(D){if(!B.empty())throw"non-empty path stack";a&&a!=H?M(a).then(d=>{0>d&&G()}):G();u();W.D(!0);t("fdlg_open")}},close:q,s:function(a){D&&(H=a,P.s(a))},G:a=>{la.push(a)},P:a=>{b=a}}})();function Oa(e,g,l){const q=new mdc.menu.MDCMenu(e);q.quickOpen=!0;g.addEventListener("click",()=>{(q.open=!q.open)&&q.root.focus()});l&&e.addEventListener("MDCMenu:selected",l)}function Pa(e){e=new mdc.dialog.MDCDialog(e);e.scrimClickAction="";return e}
function Na(){var e=document.querySelectorAll(".mdc-text-field,.mdc-checkbox");for(var g of e){e=g.classList.contains("mdc-text-field")?new mdc.textField.MDCTextField(g):new mdc.checkbox.MDCCheckbox(g);g._mdc_obj_=e;let l=g.getElementsByTagName("input")[0]||g.getElementsByTagName("textarea")[0];l&&(l._mdc_obj_=e)}g=document.querySelectorAll(".mdc-select");for(const l of g)g=new mdc.select.MDCSelect(l),l._mdc_obj_=g};
