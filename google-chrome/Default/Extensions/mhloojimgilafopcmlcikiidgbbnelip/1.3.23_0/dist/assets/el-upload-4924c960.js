import{w as e,a as t,T as s}from"./runtime-dom.esm-bundler-8f945973.js";import{b as a,d as l,E as o,_ as n,w as r}from"./index-f72b3ea9.js";import{x as i,f as u,y as d,d as c,n as p,A as f}from"./index-4f6840b9.js";import{E as m}from"./el-progress-06a69d44.js";import{N as v,r as y,a as h,u as g,t as b,n as k,h as w,a2 as F,a9 as E}from"./reactivity.esm-bundler-72867dac.js";import{t as R,d as x}from"./error-c58402b8.js";import{i as S}from"./focus-trap-a7ebc7ce.js";import{m as T}from"./typescript-5028724d.js";import{u as $}from"./index-11ecaac6.js";import{u as C,e as L}from"./index-08eda97d.js";import{d as _}from"./index-62715ce7.js";import{q as j,o as U,h as P,l as O,a as A,F as B,m as D,x as q,e as H,b as K,f as M,y as N,w as W,at as X,c as z,a9 as J,ag as G,W as I,a6 as Q}from"./runtime-core.esm-bundler-77b13fca.js";import{c as V}from"./index-854ce82e.js";const Y=Symbol("uploadContextKey");class Z extends Error{constructor(e,t,s,a){super(e),this.name="UploadAjaxError",this.status=t,this.method=s,this.url=a}}function ee(e,t,s){let a;return a=s.response?`${s.response.error||s.response}`:s.responseText?`${s.responseText}`:`fail to ${t.method} ${e} ${s.status}`,new Z(a,s.status,t.method,e)}const te=["text","picture","picture-card"];let se=1;const ae=()=>Date.now()+se++,le=a({action:{type:String,default:"#"},headers:{type:l(Object)},method:{type:String,default:"post"},data:{type:Object,default:()=>T({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},type:{type:String,default:"select"},fileList:{type:l(Array),default:()=>T([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:te,default:"text"},httpRequest:{type:l(Function),default:e=>{"undefined"==typeof XMLHttpRequest&&R("ElUpload","XMLHttpRequest is undefined");const t=new XMLHttpRequest,s=e.action;t.upload&&t.upload.addEventListener("progress",(t=>{const s=t;s.percent=t.total>0?t.loaded/t.total*100:0,e.onProgress(s)}));const a=new FormData;if(e.data)for(const[o,n]of Object.entries(e.data))Array.isArray(n)?a.append(o,...n):a.append(o,n);a.append(e.filename,e.file,e.file.name),t.addEventListener("error",(()=>{e.onError(ee(s,e,t))})),t.addEventListener("load",(()=>{if(t.status<200||t.status>=300)return e.onError(ee(s,e,t));e.onSuccess(function(e){const t=e.responseText||e.response;if(!t)return t;try{return JSON.parse(t)}catch(s){return t}}(t))})),t.open(e.method,s,!0),e.withCredentials&&"withCredentials"in t&&(t.withCredentials=!0);const l=e.headers||{};if(l instanceof Headers)l.forEach(((e,s)=>t.setRequestHeader(s,e)));else for(const[o,n]of Object.entries(l))S(n)||t.setRequestHeader(o,String(n));return t.send(a),t}},disabled:Boolean,limit:Number}),oe=a({...le,beforeUpload:{type:l(Function),default:v},beforeRemove:{type:l(Function)},onRemove:{type:l(Function),default:v},onChange:{type:l(Function),default:v},onPreview:{type:l(Function),default:v},onSuccess:{type:l(Function),default:v},onProgress:{type:l(Function),default:v},onError:{type:l(Function),default:v},onExceed:{type:l(Function),default:v}}),ne=a({files:{type:l(Array),default:()=>T([])},disabled:{type:Boolean,default:!1},handlePreview:{type:l(Function),default:v},listType:{type:String,values:te,default:"text"}}),re=["onKeydown"],ie=["src"],ue=["onClick"],de=["onClick"],ce=["onClick"],pe=j({name:"ElUploadList"});var fe=n(j({...pe,props:ne,emits:{remove:e=>!!e},setup(a,{emit:l}){const{t:n}=$(),r=C("upload"),v=C("icon"),w=C("list"),F=_(),E=y(!1),R=e=>{l("remove",e)};return(a,l)=>(U(),P(s,{tag:"ul",class:h([g(r).b("list"),g(r).bm("list",a.listType),g(r).is("disabled",g(F))]),name:g(w).b()},{default:O((()=>[(U(!0),A(B,null,D(a.files,(s=>(U(),A("li",{key:s.uid||s.name,class:h([g(r).be("list","item"),g(r).is(s.status),{focusing:E.value}]),tabindex:"0",onKeydown:e((e=>!g(F)&&R(s)),["delete"]),onFocus:l[0]||(l[0]=e=>E.value=!0),onBlur:l[1]||(l[1]=e=>E.value=!1),onClick:l[2]||(l[2]=e=>E.value=!1)},[q(a.$slots,"default",{file:s},(()=>["picture"===a.listType||"uploading"!==s.status&&"picture-card"===a.listType?(U(),A("img",{key:0,class:h(g(r).be("list","item-thumbnail")),src:s.url,alt:""},null,10,ie)):H("v-if",!0),"uploading"===s.status||"picture-card"!==a.listType?(U(),A("div",{key:1,class:h(g(r).be("list","item-info"))},[K("a",{class:h(g(r).be("list","item-name")),onClick:t((e=>a.handlePreview(s)),["prevent"])},[M(g(o),{class:h(g(v).m("document"))},{default:O((()=>[M(g(i))])),_:1},8,["class"]),K("span",{class:h(g(r).be("list","item-file-name"))},b(s.name),3)],10,ue),"uploading"===s.status?(U(),P(g(m),{key:0,type:"picture-card"===a.listType?"circle":"line","stroke-width":"picture-card"===a.listType?6:2,percentage:Number(s.percentage),style:k("picture-card"===a.listType?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):H("v-if",!0)],2)):H("v-if",!0),K("label",{class:h(g(r).be("list","item-status-label"))},["text"===a.listType?(U(),P(g(o),{key:0,class:h([g(v).m("upload-success"),g(v).m("circle-check")])},{default:O((()=>[M(g(u))])),_:1},8,["class"])):["picture-card","picture"].includes(a.listType)?(U(),P(g(o),{key:1,class:h([g(v).m("upload-success"),g(v).m("check")])},{default:O((()=>[M(g(d))])),_:1},8,["class"])):H("v-if",!0)],2),g(F)?H("v-if",!0):(U(),P(g(o),{key:2,class:h(g(v).m("close")),onClick:e=>R(s)},{default:O((()=>[M(g(c))])),_:2},1032,["class","onClick"])),H(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),H(" This is a bug which needs to be fixed "),H(" TODO: Fix the incorrect navigation interaction "),g(F)?H("v-if",!0):(U(),A("i",{key:3,class:h(g(v).m("close-tip"))},b(g(n)("el.upload.deleteTip")),3)),"picture-card"===a.listType?(U(),A("span",{key:4,class:h(g(r).be("list","item-actions"))},[K("span",{class:h(g(r).be("list","item-preview")),onClick:e=>a.handlePreview(s)},[M(g(o),{class:h(g(v).m("zoom-in"))},{default:O((()=>[M(g(p))])),_:1},8,["class"])],10,de),g(F)?H("v-if",!0):(U(),A("span",{key:0,class:h(g(r).be("list","item-delete")),onClick:e=>R(s)},[M(g(o),{class:h(g(v).m("delete"))},{default:O((()=>[M(g(f))])),_:1},8,["class"])],10,ce))],2)):H("v-if",!0)]))],42,re)))),128)),q(a.$slots,"append")])),_:3},8,["class","name"]))}}),[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-list.vue"]]);const me=a({disabled:{type:Boolean,default:!1}}),ve={file:e=>w(e)},ye=["onDrop","onDragover"],he="ElUploadDrag",ge=j({name:he});var be=n(j({...ge,props:me,emits:ve,setup(e,{emit:s}){const a=N(Y);a||R(he,"usage: <el-upload><el-upload-dragger /></el-upload>");const l=C("upload"),o=y(!1),n=_(),r=e=>{if(n.value)return;o.value=!1;const t=Array.from(e.dataTransfer.files),l=a.accept.value;if(!l)return void s("file",t);const r=t.filter((e=>{const{type:t,name:s}=e,a=s.includes(".")?`.${s.split(".").pop()}`:"",o=t.replace(/\/.*$/,"");return l.split(",").map((e=>e.trim())).filter((e=>e)).some((e=>e.startsWith(".")?a===e:/\/\*$/.test(e)?o===e.replace(/\/\*$/,""):!!/^[^/]+\/[^/]+$/.test(e)&&t===e))}));s("file",r)},i=()=>{n.value||(o.value=!0)};return(e,s)=>(U(),A("div",{class:h([g(l).b("dragger"),g(l).is("dragover",o.value)]),onDrop:t(r,["prevent"]),onDragover:t(i,["prevent"]),onDragleave:s[0]||(s[0]=t((e=>o.value=!1),["prevent"]))},[q(e.$slots,"default")],42,ye))}}),[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-dragger.vue"]]);const ke=a({...le,beforeUpload:{type:l(Function),default:v},onRemove:{type:l(Function),default:v},onStart:{type:l(Function),default:v},onSuccess:{type:l(Function),default:v},onProgress:{type:l(Function),default:v},onError:{type:l(Function),default:v},onExceed:{type:l(Function),default:v}}),we=["onKeydown"],Fe=["name","multiple","accept"],Ee=j({name:"ElUploadContent",inheritAttrs:!1});var Re=n(j({...Ee,props:ke,setup(s,{expose:a}){const l=s,o=C("upload"),n=_(),r=F({}),i=F(),u=e=>{if(0===e.length)return;const{autoUpload:t,limit:s,fileList:a,multiple:o,onStart:n,onExceed:r}=l;if(s&&a.length+e.length>s)r(e,a);else{o||(e=e.slice(0,1));for(const s of e){const e=s;e.uid=ae(),n(e),t&&d(e)}}},d=async e=>{if(i.value.value="",!l.beforeUpload)return c(e);let t;try{t=await l.beforeUpload(e)}catch(a){t=!1}if(!1===t)return void l.onRemove(e);let s=e;t instanceof Blob&&(s=t instanceof File?t:new File([t],e.name,{type:e.type})),c(Object.assign(s,{uid:e.uid}))},c=e=>{const{headers:t,data:s,method:a,withCredentials:o,name:n,action:i,onProgress:u,onSuccess:d,onError:c,httpRequest:p}=l,{uid:f}=e,m={headers:t||{},withCredentials:o,file:e,data:s,method:a,filename:n,action:i,onProgress:t=>{u(t,e)},onSuccess:t=>{d(t,e),delete r.value[f]},onError:t=>{c(t,e),delete r.value[f]}},v=p(m);r.value[f]=v,v instanceof Promise&&v.then(m.onSuccess,m.onError)},p=e=>{const t=e.target.files;t&&u(Array.from(t))},f=()=>{n.value||(i.value.value="",i.value.click())},m=()=>{f()};return a({abort:e=>{L(r.value).filter(e?([t])=>String(e.uid)===t:()=>!0).forEach((([e,t])=>{t instanceof XMLHttpRequest&&t.abort(),delete r.value[e]}))},upload:d}),(s,a)=>(U(),A("div",{class:h([g(o).b(),g(o).m(s.listType),g(o).is("drag",s.drag)]),tabindex:"0",onClick:f,onKeydown:e(t(m,["self"]),["enter","space"])},[s.drag?(U(),P(be,{key:0,disabled:g(n),onFile:u},{default:O((()=>[q(s.$slots,"default")])),_:3},8,["disabled"])):q(s.$slots,"default",{key:1}),K("input",{ref_key:"inputRef",ref:i,class:h(g(o).e("input")),name:s.name,multiple:s.multiple,accept:s.accept,type:"file",onChange:p,onClick:a[0]||(a[0]=t((()=>{}),["stop"]))},null,42,Fe)],42,we))}}),[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-content.vue"]]);const xe="ElUpload",Se=(e,t)=>{const s=V(e,"fileList",void 0,{passive:!0}),a=e=>s.value.find((t=>t.uid===e.uid));function l(e){var s;null==(s=t.value)||s.abort(e)}return W((()=>e.listType),(t=>{"picture-card"!==t&&"picture"!==t||(s.value=s.value.map((t=>{const{raw:a,url:l}=t;if(!l&&a)try{t.url=URL.createObjectURL(a)}catch(o){e.onError(o,t,s.value)}return t})))})),W(s,(e=>{for(const t of e)t.uid||(t.uid=ae()),t.status||(t.status="success")}),{immediate:!0,deep:!0}),{uploadFiles:s,abort:l,clearFiles:function(e=["ready","uploading","success","fail"]){s.value=s.value.filter((t=>!e.includes(t.status)))},handleError:(t,l)=>{const o=a(l);o&&(console.error(t),o.status="fail",s.value.splice(s.value.indexOf(o),1),e.onError(t,o,s.value),e.onChange(o,s.value))},handleProgress:(t,l)=>{const o=a(l);o&&(e.onProgress(t,o,s.value),o.status="uploading",o.percentage=Math.round(t.percent))},handleStart:t=>{S(t.uid)&&(t.uid=ae());const a={name:t.name,percentage:0,status:"ready",size:t.size,raw:t,uid:t.uid};if("picture-card"===e.listType||"picture"===e.listType)try{a.url=URL.createObjectURL(t)}catch(l){x(xe,l.message),e.onError(l,a,s.value)}s.value=[...s.value,a],e.onChange(a,s.value)},handleSuccess:(t,l)=>{const o=a(l);o&&(o.status="success",o.response=t,e.onSuccess(t,o,s.value),e.onChange(o,s.value))},handleRemove:async t=>{const o=t instanceof File?a(t):t;o||R(xe,"file to be removed not found");const n=t=>{l(t);const a=s.value;a.splice(a.indexOf(t),1),e.onRemove(t,a),(e=>{var t;(null==(t=e.url)?void 0:t.startsWith("blob:"))&&URL.revokeObjectURL(e.url)})(t)};if(e.beforeRemove){!1!==await e.beforeRemove(o,s.value)&&n(o)}else n(o)},submit:function(){s.value.filter((({status:e})=>"ready"===e)).forEach((({raw:e})=>{var s;return e&&(null==(s=t.value)?void 0:s.upload(e))}))}}},Te=j({name:"ElUpload"});const $e=r(n(j({...Te,props:oe,setup(e,{expose:t}){const s=e,a=X(),l=_(),o=F(),{abort:n,submit:r,clearFiles:i,uploadFiles:u,handleStart:d,handleError:c,handleRemove:p,handleSuccess:f,handleProgress:m}=Se(s,o),v=z((()=>"picture-card"===s.listType)),y=z((()=>({...s,fileList:u.value,onStart:d,onProgress:m,onSuccess:f,onError:c,onRemove:p})));return J((()=>{u.value.forEach((({url:e})=>{(null==e?void 0:e.startsWith("blob:"))&&URL.revokeObjectURL(e)}))})),G(Y,{accept:E(s,"accept")}),t({abort:n,submit:r,clearFiles:i,handleStart:d,handleRemove:p}),(e,t)=>(U(),A("div",null,[g(v)&&e.showFileList?(U(),P(fe,{key:0,disabled:g(l),"list-type":e.listType,files:g(u),"handle-preview":e.onPreview,onRemove:g(p)},I({append:O((()=>[M(Re,Q({ref_key:"uploadRef",ref:o},g(y)),{default:O((()=>[g(a).trigger?q(e.$slots,"trigger",{key:0}):H("v-if",!0),!g(a).trigger&&g(a).default?q(e.$slots,"default",{key:1}):H("v-if",!0)])),_:3},16)])),_:2},[e.$slots.file?{name:"default",fn:O((({file:t})=>[q(e.$slots,"file",{file:t})]))}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):H("v-if",!0),!g(v)||g(v)&&!e.showFileList?(U(),P(Re,Q({key:1,ref_key:"uploadRef",ref:o},g(y)),{default:O((()=>[g(a).trigger?q(e.$slots,"trigger",{key:0}):H("v-if",!0),!g(a).trigger&&g(a).default?q(e.$slots,"default",{key:1}):H("v-if",!0)])),_:3},16)):H("v-if",!0),e.$slots.trigger?q(e.$slots,"default",{key:2}):H("v-if",!0),q(e.$slots,"tip"),!g(v)&&e.showFileList?(U(),P(fe,{key:3,disabled:g(l),"list-type":e.listType,files:g(u),"handle-preview":e.onPreview,onRemove:g(p)},I({_:2},[e.$slots.file?{name:"default",fn:O((({file:t})=>[q(e.$slots,"file",{file:t})]))}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):H("v-if",!0)]))}}),[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload.vue"]]));export{$e as E};
