import{r as e,b as t,aa as n,d as o,g as l,i as s,l as i}from"./reactivity.esm-bundler-72867dac.js";import{c as r,b as a,d as u}from"./runtime-dom.esm-bundler-8f945973.js";import{u as d}from"./index-08eda97d.js";import{o as c,b as m,m as v,p as b}from"./style-ac750348.js";import{n as g,l as f,g as p,f as x,v as y}from"./runtime-core.esm-bundler-77b13fca.js";import{u as C}from"./index-e1484003.js";import"./_MapCache-31dad113.js";import"./isSymbol-1e3d4c76.js";function k(o){let l;const s=d("loading"),i=e(!1),m=t({...o,originalPosition:"",originalOverflow:"",visible:!1});function v(){var e,t;null==(t=null==(e=C.$el)?void 0:e.parentNode)||t.removeChild(C.$el)}function b(){if(!i.value)return;const e=m.parent;i.value=!1,e.vLoadingAddClassList=void 0,function(){const e=m.parent;if(!e.vLoadingAddClassList){let t=e.getAttribute("loading-number");t=Number.parseInt(t)-1,t?e.setAttribute("loading-number",t.toString()):(c(e,s.bm("parent","relative")),e.removeAttribute("loading-number")),c(e,s.bm("parent","hidden"))}v(),y.unmount()}()}const y=r({name:"ElLoading",setup:()=>()=>{const e=m.spinner||m.svg,t=g("svg",{class:"circular",viewBox:m.svgViewBox?m.svgViewBox:"0 0 50 50",...e?{innerHTML:e}:{}},[g("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})]),n=m.text?g("p",{class:s.b("text")},[m.text]):void 0;return g(u,{name:s.b("fade"),onAfterLeave:b},{default:f((()=>[p(x("div",{style:{backgroundColor:m.background||""},class:[s.b("mask"),m.customClass,m.fullscreen?"is-fullscreen":""]},[g("div",{class:s.b("spinner")},[t,n])]),[[a,m.visible]])]))})}}),C=y.mount(document.createElement("div"));return{...n(m),setText:function(e){m.text=e},removeElLoadingChild:v,close:function(){var e;o.beforeClose&&!o.beforeClose()||(i.value=!0,clearTimeout(l),l=window.setTimeout(b,400),m.visible=!1,null==(e=o.closed)||e.call(o))},handleAfterLeave:b,vm:C,get $el(){return C.$el}}}let L;const w=function(e={}){if(!m)return;const t=h(e);if(t.fullscreen&&L)return L;const n=k({...t,closed:()=>{var e;null==(e=t.closed)||e.call(t),t.fullscreen&&(L=void 0)}});A(t,t.parent,n),$(t,t.parent,n),t.parent.vLoadingAddClassList=()=>$(t,t.parent,n);let o=t.parent.getAttribute("loading-number");return o=o?`${Number.parseInt(o)+1}`:"1",t.parent.setAttribute("loading-number",o),t.parent.appendChild(n.$el),y((()=>n.visible.value=t.visible)),t.fullscreen&&(L=n),n},h=e=>{var t,n,l,s;let i;return i=o(e.target)?null!=(t=document.querySelector(e.target))?t:document.body:e.target||document.body,{parent:i===document.body||e.body?document.body:i,background:e.background||"",svg:e.svg||"",svgViewBox:e.svgViewBox||"",spinner:e.spinner||!1,text:e.text||"",fullscreen:i===document.body&&(null==(n=e.fullscreen)||n),lock:null!=(l=e.lock)&&l,customClass:e.customClass||"",visible:null==(s=e.visible)||s,target:i}},A=async(e,t,n)=>{const{nextZIndex:o}=C(),l={};if(e.fullscreen)n.originalPosition.value=v(document.body,"position"),n.originalOverflow.value=v(document.body,"overflow"),l.zIndex=o();else if(e.parent===document.body){n.originalPosition.value=v(document.body,"position"),await y();for(const t of["top","left"]){const n="top"===t?"scrollTop":"scrollLeft";l[t]=e.target.getBoundingClientRect()[t]+document.body[n]+document.documentElement[n]-Number.parseInt(v(document.body,`margin-${t}`),10)+"px"}for(const t of["height","width"])l[t]=`${e.target.getBoundingClientRect()[t]}px`}else n.originalPosition.value=v(t,"position");for(const[s,i]of Object.entries(l))n.$el.style[s]=i},$=(e,t,n)=>{const o=d("loading");["absolute","fixed","sticky"].includes(n.originalPosition.value)?c(t,o.bm("parent","relative")):b(t,o.bm("parent","relative")),e.fullscreen&&e.lock?b(t,o.bm("parent","hidden")):c(t,o.bm("parent","hidden"))},j=Symbol("ElLoading"),B=(t,n)=>{var s,r,a,u;const d=n.instance,c=e=>l(n.value)?n.value[e]:void 0,m=n=>(t=>{const n=o(t)&&(null==d?void 0:d[t])||t;return n?e(n):n})(c(n)||t.getAttribute(`element-loading-${i(n)}`)),v=null!=(s=c("fullscreen"))?s:n.modifiers.fullscreen,b={text:m("text"),svg:m("svg"),svgViewBox:m("svgViewBox"),spinner:m("spinner"),background:m("background"),customClass:m("customClass"),fullscreen:v,target:null!=(r=c("target"))?r:v?void 0:t,body:null!=(a=c("body"))?a:n.modifiers.body,lock:null!=(u=c("lock"))?u:n.modifiers.lock};t[j]={options:b,instance:w(b)}},V={mounted(e,t){t.value&&B(e,t)},updated(e,t){const n=e[j];t.oldValue!==t.value&&(t.value&&!t.oldValue?B(e,t):t.value&&t.oldValue?l(t.value)&&((e,t)=>{for(const n of Object.keys(t))s(t[n])&&(t[n].value=e[n])})(t.value,n.options):null==n||n.instance.close())},unmounted(e){var t;null==(t=e[j])||t.instance.close()}},E={install(e){e.directive("loading",V),e.config.globalProperties.$loading=w},directive:V,service:w};export{E as ElLoading,V as ElLoadingDirective,w as ElLoadingService,E as default,V as vLoading};
