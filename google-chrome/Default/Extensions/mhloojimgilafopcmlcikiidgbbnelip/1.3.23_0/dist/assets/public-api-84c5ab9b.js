import{_ as e}from"./preload-helper-706a0e5c.js";import{l as t}from"./local-82fd2aea.js";import{d as a}from"./dayjs.min-39fed9c4.js";import{a as o}from"./index-98e2e8c6.js";import{d as i}from"./website-234d9ff3.js";import{isEmptyObject as s}from"./utils-73d66301.js";import{d as n}from"./index-2a5711a9.js";import{a as l,u as r}from"./globStorageState-d3feed6a.js";import{u as g,f}from"./notes-a9d23bdb.js";import{u as c}from"./todo-998e5e96.js";import{u as d}from"./stocks-0eb3a6ed.js";import u from"./indexdb-76ab5eed.js";import{u as m}from"./baseRequest-a74f719c.js";const b=l(),p=r(),h=c(),y=g(),v=d(),C=[{key:"baidu",title:"百度",href:"https://www.baidu.com/s?&tn=68018901_2_oem_dgie=utf-8&wd="},{key:"google",title:"Google",href:"https://www.google.com/search?q="},{key:"bing",title:"必应",href:"https://www.bing.com/search?q="},{key:"github",title:"gitHub",href:"https://github.com/search?q="}];!h.value&&(h.value=[]),!y.value&&(y.value=[]);const w=e=>{var t,a,o;e.baseConfig&&(e.baseConfig.searchEngine||(e.baseConfig.searchEngine=C),e.baseConfig.open||(e.baseConfig.open={searchBlank:null==(a=null==(t=e.baseConfig)?void 0:t.search)?void 0:a.blank,iconBlank:null==(o=p.value.search)?void 0:o.blank}),p.value=e.baseConfig),e.navConfig&&(b.value=e.navConfig),e.todo&&(u.set("todo",e.todo),h.value=e.notes.slice(0,3)),e.notes&&(u.set("notes",e.notes),y.value=e.notes.slice(0,3),f.value=e.notes.filter((e=>e&&e.fixed))),e.stocks&&(v.value=e.stocks),localStorage.setItem("dataCleansing","null")};window.addEventListener("storage",(e=>{if("navConfig"===e.key){let e=t.get("navConfig")||[];e.length&&(b.value=e,l().value=e)}}));const _=(e,a)=>{t.get("token")&&(t.set("asyncTime",a),e||(e={baseConfig:1,navConfig:1,notes:1,todo:1}),n("同步中","loading"),o.itabConfig(e).then((e=>{n("同步成功","check");let t=e.data;t&&t.iTabConfig&&(t=JSON.parse(t.iTabConfig)),t&&w(t)})))},T=m(),j=async()=>{let i=await e((()=>import("./indexdb-76ab5eed.js")),["./indexdb-76ab5eed.js","./localforage-5beca937.js","./_commonjsHelpers-e5557959.js","./_commonjs-dynamic-modules-3e972b61.js","./dayjs.min-39fed9c4.js"],import.meta.url);i=i.default;let s=await i.get("todayBing"),n=a().format("YYYYMMDD");if(s&&s.enddate==n)return s;let l=await o.getBing(),r=l.data||{};return i.set("todayBing",l.data||{}),t.set("todayBing",{thumb:r.thumb,copyright:r.copyright}),r||{}};async function k(e,t){for(let a=0;a<e.length;a++)await t(e[a],a,e)}const A=async(i,s)=>{let l=await e((()=>import("./indexdb-76ab5eed.js")),["./indexdb-76ab5eed.js","./localforage-5beca937.js","./_commonjsHelpers-e5557959.js","./_commonjs-dynamic-modules-3e972b61.js","./dayjs.min-39fed9c4.js"],import.meta.url);if(l=l.default,l.get("configHistory").then((async e=>{let o=e||[];if("navConfig"===i||!i){let e=["baseConfig","navConfig","notes","todo","stocks"],i={};await k(e,(async e=>{if(["notes","todo"].includes(e)){let a=await l.get(e)||t.get(e)||[];i[e]=a}else i[e]=t.get(e)})),o.unshift({data:i||[],ct:a().valueOf()}),l.set("configHistory",o.slice(0,10))}})),!t.get("token"))return;let r=["baseConfig","navConfig","notes","todo","stocks"],g={},f={saveType:s},c=T.value.itabAsyncTime||{};if(i){let e=a().valueOf();if(["notes","todo"].includes(i)){let e=await l.get(i)||t.get(i)||[];f[i]=e}else f[i]=t.get(i);c[i]=e,g[`itabAsyncTime.${i}`]=e}else{let e=a().valueOf();await k(r,(async a=>{c[a]=e;if(["notes","todo"].includes(a)){let e=await l.get(a)||t.get(a)||[];f[a]=e}else f[a]=t.get(a);g[`itabAsyncTime.${a}`]=e}))}n("备份中...","loading"),o.itabConfigUpdate(f).then((()=>{o.userUpdate(g),t.set("asyncTime",c),setTimeout((()=>{n("备份成功","check")}),260),T.value.itabAsyncTime=c})).catch((()=>{n("备份失败","close"),e((()=>import("./index-da9a90a7.js")),["./index-da9a90a7.js","./runtime-dom.esm-bundler-8f945973.js","./runtime-core.esm-bundler-77b13fca.js","./reactivity.esm-bundler-72867dac.js","./config-provider-6b9f90d0.js","./index-f72b3ea9.js","./index-08eda97d.js","./_MapCache-31dad113.js","./isSymbol-1e3d4c76.js","./style-ac750348.js","./index-62715ce7.js","./index-854ce82e.js","./typescript-5028724d.js","./icon-b1cf815e.js","./index-4f6840b9.js","./aria-60e0cdc6.js","./index-e1484003.js"],import.meta.url).then((e=>{e.ElMessage({type:"error",message:"备份失败，稍后请手动尝试",duration:0,showClose:!0})}))}))},E=Object.freeze(Object.defineProperty({__proto__:null,getTodayBing:j,getUserInfo:()=>{t.get("token")?o.userInfo({from:"itab",t:(new Date).getTime()}).then((e=>{T.value=e.data||{};let a=t.get("asyncTime"),o={};for(let t in e.data.itabAsyncTime)a[t]!=e.data.itabAsyncTime[t]&&(o[t]=1);s(o)||_(o,e.data.itabAsyncTime)})):T.value={}},saveConfig:A,asyncConfig:async e=>{if(!T.value._id)return{};if(t.get("asyncTime")[e]==T.value.itabAsyncTime[e])return{};n("同步中","loading");let a={};a[e]=1;let i=await o.itabConfig(a);return n("同步成功","check"),i},delIcon:async e=>{if(e&&e.includes("user_")){let t=[e.replace("https://files.codelife.cc/","")];i({paths:t})}}},Symbol.toStringTag,{value:"Module"}));export{_ as A,j as g,E as p,A as s,w};
